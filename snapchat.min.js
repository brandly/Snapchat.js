(function(e,t){"use strict";var o={hasTouch:"ontouchstart"in t.documentElement,createVerticalRainbow:function(e,t){var o=e.createLinearGradient(0,0,0,t);return o.addColorStop(0,"rgb(255,   0,   0)"),o.addColorStop(.15,"rgb(255,   0, 255)"),o.addColorStop(.33,"rgb(0,     0, 255)"),o.addColorStop(.49,"rgb(0,   255, 255)"),o.addColorStop(.67,"rgb(0,   255,   0)"),o.addColorStop(.84,"rgb(255, 255,   0)"),o.addColorStop(1,"rgb(255,   0,   0)"),o},relativeMouseCoords:function(t,o){var n=0,r=0;do n+=o.offsetLeft-o.scrollLeft,r+=o.offsetTop-o.scrollTop;while(o=o.offsetParent);return console.log(e),{x:t.pageX-n-e.scrollX,y:t.pageY-r-e.scrollY}},css:function(e,t){for(var o in t)e.style[o]=t[o]},draw:function(e,t,o){e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(o.x,o.y),e.closePath(),e.stroke()},borderStyles:{border:"4px solid white",borderRadius:"5px","box-shadow":"0 0 5px black"}},n={down:o.hasTouch?"touchstart":"mousedown",move:o.hasTouch?"touchmove":"mousemove",up:o.hasTouch?"touchend":"mouseup",out:o.hasTouch?"touchcancel":"mouseout"},r={element:t.createElement("canvas"),size:{width:15,height:200},init:function(){var e,i=r.element;r.context=e=i.getContext("2d"),i.width=this.size.width,i.height=this.size.height,this.context.fillStyle=o.createVerticalRainbow(e,this.size.height),this.context.fillRect(0,0,this.size.width,this.size.height),i.addEventListener(n.down,function(e){function t(){i.removeEventListener(n.move,r.setDrawingColor),i.removeEventListener(n.up,t),i.removeEventListener(n.out,t)}r.setDrawingColor(e),i.addEventListener(n.move,r.setDrawingColor),i.addEventListener(n.up,t),i.addEventListener(n.out,t)}),o.css(i,{position:"fixed",top:"95px",right:"10px",zIndex:"1001",display:"none"}),o.css(i,o.borderStyles),t.body.appendChild(i)},setDrawingColor:function(e){var t=o.relativeMouseCoords(e,r.element),n=r.context.getImageData(0,Math.min(t.y,r.size.height-1),1,1).data;i.setCurrentColor(n)},isVisibile:function(){return""===r.element.style.display},show:function(){o.css(r.element,{display:""})},hide:function(){o.css(r.element,{display:"none"})}},i={element:t.createElement("div"),init:function(){var e=i.element;e.addEventListener("click",function(){r.isVisibile()?(r.hide(),s.disable(),l.hide()):(r.show(),s.enable(),l.refresh())}),o.css(e,{width:"60px",height:"60px",position:"fixed",top:"10px",right:"10px",zIndex:"1001",cursor:"pointer"}),o.css(e,o.borderStyles),i.refresh(),t.body.appendChild(e)},currentColor:[255,0,0],getCurrentColor:function(){return"rgb("+i.currentColor.join(",")+")"},setCurrentColor:function(e){for(var t=0;3>t;t++)i.currentColor[t]=e[t];i.refresh()},refresh:function(){var e=i.getCurrentColor();o.css(i.element,{backgroundColor:e}),s.setColor(e)}},s={element:t.createElement("canvas"),history:[],init:function(){var e,r=s.element;s.context=e=this.element.getContext("2d"),r.width=t.body.scrollWidth,r.height=t.body.scrollHeight;var d=null;r.addEventListener(n.down,function(t){function c(t){var n=o.relativeMouseCoords(t,r);o.draw(e,d,n),d=n,h.push(n)}function a(){r.removeEventListener(n.move,c),r.removeEventListener(n.up,a),s.history.push(h),l.refresh()}var h=[];h.color=i.getCurrentColor(),d=o.relativeMouseCoords(t,r),h.push(d),r.addEventListener(n.move,c),r.addEventListener(n.up,a)}),o.css(r,{zIndex:"1000",position:"absolute",top:0,left:0,"pointer-events":"none"}),s.defaultLineStyle(),t.body.appendChild(r)},defaultLineStyle:function(){s.context.lineWidth=5,s.context.lineJoin="round"},setColor:function(e){s.context.strokeStyle=e},enable:function(){o.css(s.element,{"pointer-events":"",cursor:"crosshair"})},disable:function(){o.css(s.element,{"pointer-events":"none",cursor:""})},redraw:function(){s.element.width=s.element.width,s.defaultLineStyle();for(var e=0,t=s.history.length;t>e;e++){var n=s.history[e];s.setColor(n.color);for(var r=0,l=n.length-1;l>r;r++)o.draw(s.context,n[r],n[r+1])}i.refresh()},undo:function(){s.history.pop(),s.redraw(),l.refresh()}},l={element:t.createElement("canvas"),init:function(){var e,n=l.element;l.context=e=n.getContext("2d"),n.addEventListener("click",function(){s.undo()}),o.css(n,{display:"none",width:"50px",height:"50px",position:"fixed",top:"10px",right:"90px",zIndex:"1001",cursor:"pointer"}),o.css(n,o.borderStyles),t.body.appendChild(n)},show:function(){o.css(l.element,{display:""})},hide:function(){o.css(l.element,{display:"none"})},refresh:function(){if(s.history.length){var e=s.history[s.history.length-1].color;o.css(l.element,{backgroundColor:e}),l.show()}else l.hide()}};s.init(),i.init(),r.init(),l.init()}).call(this,window,document);