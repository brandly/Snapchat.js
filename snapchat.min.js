(function(e,t){"use strict";var o={hasTouch:"ontouchstart"in t.documentElement,createVerticalRainbow:function(e,t){var o=e.createLinearGradient(0,0,0,t);return o.addColorStop(0,"rgb(255,   0,   0)"),o.addColorStop(.15,"rgb(255,   0, 255)"),o.addColorStop(.33,"rgb(0,     0, 255)"),o.addColorStop(.49,"rgb(0,   255, 255)"),o.addColorStop(.67,"rgb(0,   255,   0)"),o.addColorStop(.84,"rgb(255, 255,   0)"),o.addColorStop(1,"rgb(255,   0,   0)"),o},relativeMouseCoords:function(e,t){var o=0,n=0;do o+=t.offsetLeft-t.scrollLeft,n+=t.offsetTop-t.scrollTop;while(t=t.offsetParent);return{x:e.pageX-o,y:e.pageY-n}},css:function(e,t){for(var o in t)e.style[o]=t[o]},draw:function(e,t,o){e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(o.x,o.y),e.closePath(),e.stroke()},borderStyles:{border:"4px solid white",borderRadius:"5px","box-shadow":"0 0 5px black"}},n={down:o.hasTouch?"touchstart":"mousedown",move:o.hasTouch?"touchmove":"mousemove",up:o.hasTouch?"touchend":"mouseup",out:o.hasTouch?"touchcancel":"mouseout"},i={element:t.createElement("canvas"),size:{width:15,height:200},init:function(){var e,r=i.element;i.context=e=r.getContext("2d"),r.width=this.size.width,r.height=this.size.height,this.context.fillStyle=o.createVerticalRainbow(e,this.size.height),this.context.fillRect(0,0,this.size.width,this.size.height),r.addEventListener(n.down,function(e){function t(){r.removeEventListener(n.move,i.setDrawingColor),r.removeEventListener(n.up,t),r.removeEventListener(n.out,t)}i.setDrawingColor(e),r.addEventListener(n.move,i.setDrawingColor),r.addEventListener(n.up,t),r.addEventListener(n.out,t)}),o.css(r,{position:"absolute",top:"95px",right:"10px",zIndex:"1001",display:"none"}),o.css(r,o.borderStyles),t.body.appendChild(r)},setDrawingColor:function(e){var t=o.relativeMouseCoords(e,i.element),n=i.context.getImageData(0,Math.min(t.y,i.size.height-1),1,1).data;r.setCurrentColor(n)},isVisibile:function(){return""===i.element.style.display},show:function(){o.css(i.element,{display:""})},hide:function(){o.css(i.element,{display:"none"})}},r={element:t.createElement("div"),init:function(){var e=r.element;e.addEventListener("click",function(){i.isVisibile()?(i.hide(),s.disable(),l.hide()):(i.show(),s.enable(),l.refresh())}),o.css(e,{width:"60px",height:"60px",position:"absolute",top:"10px",right:"10px",zIndex:"1001"}),o.css(e,o.borderStyles),r.refresh(),t.body.appendChild(e)},currentColor:[255,0,0],getCurrentColor:function(){return"rgb("+r.currentColor.join(",")+")"},setCurrentColor:function(e){for(var t=0;3>t;t++)r.currentColor[t]=e[t];r.refresh()},refresh:function(){var e=r.getCurrentColor();o.css(r.element,{backgroundColor:e}),s.setColor(e)}},s={element:t.createElement("canvas"),history:[],init:function(){var i,d=s.element;s.context=i=this.element.getContext("2d"),d.width=e.innerWidth,d.height=e.innerHeight;var a=null;d.addEventListener(n.down,function(e){function t(e){var t=o.relativeMouseCoords(e,d);o.draw(i,a,t),a=t,h.push(t)}function c(){d.removeEventListener(n.move,t),d.removeEventListener(n.up,c),s.history.push(h),l.refresh()}var h=[];h.color=r.getCurrentColor(),a=o.relativeMouseCoords(e,d),h.push(a),d.addEventListener(n.move,t),d.addEventListener(n.up,c)}),o.css(d,{zIndex:"1000",position:"absolute",top:0,left:0,"pointer-events":"none"}),s.defaultLineStyle(),t.body.appendChild(d)},defaultLineStyle:function(){s.context.lineWidth=5,s.context.lineJoin="round"},setColor:function(e){s.context.strokeStyle=e},enable:function(){o.css(s.element,{"pointer-events":""})},disable:function(){o.css(s.element,{"pointer-events":"none"})},redraw:function(){s.element.width=s.element.width,s.defaultLineStyle();for(var e=0,t=s.history.length;t>e;e++){var n=s.history[e];s.setColor(n.color);for(var i=0,l=n.length-1;l>i;i++)o.draw(s.context,n[i],n[i+1])}r.refresh()},undo:function(){s.history.pop(),s.redraw(),l.refresh()}},l={element:t.createElement("canvas"),size:{width:15,height:200},init:function(){var e,n=l.element;l.context=e=n.getContext("2d"),n.addEventListener("click",function(){s.undo()}),o.css(n,{display:"none",width:"50px",height:"50px",position:"absolute",top:"10px",right:"90px",zIndex:"1001"}),o.css(n,o.borderStyles),t.body.appendChild(n)},show:function(){o.css(l.element,{display:""})},hide:function(){o.css(l.element,{display:"none"})},refresh:function(){if(s.history.length){var e=s.history[s.history.length-1].color;o.css(l.element,{backgroundColor:e}),l.show()}else l.hide()}};s.init(),r.init(),i.init(),l.init()}).call(this,window,document);